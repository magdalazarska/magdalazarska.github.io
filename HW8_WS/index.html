<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Contact List</title>
</head>
<body>
    <input id="first-name" />
    <input id="last-name" />
    <input id="phone-number" />
    <input id="email" />
    <button id="add-contact">Add Contact</button>
    <ul id="contacts"></ul>

    <script>
        var contactList = document.getElementById('contacts');
        var firstNameInput = document.getElementById('first-name');
        var lastNameInput = document.getElementById('last-name');
        var phoneNumberInput = document.getElementById('phone-number');
        var emailInput = document.getElementById('email');
        var addContactButton = document.getElementById('add-contact');

        syncContacts();

        addContactButton.addEventListener('click', addContact);

        function addContact() {
            var contact = {
                firstName: firstNameInput.value,
                lastName: lastNameInput.value,
                phoneNumber: phoneNumberInput.value,
                email: emailInput.value,
            };

            firstNameInput.value = '';
            lastNameInput.value = '';
            phoneNumberInput.value = '';
            emailInput.value = '';

            fetch(
                'http://localhost:3000/contacts', {
                    method: 'POST',
                    body: JSON.stringify(contact),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }
            ).then(function () {
                syncContacts();
            })
        }

        function updateContact(contactId, contactFirstName, contactLastName, contactPhoneNumber, contactEmail) {
            var updateContact = {
                firstName: contactFirstName,
                lastName: contactLastName,
                phoneNumber: contactPhoneNumber,
                email: contactEmail,
            };

            fetch(
                'http://localhost:3000/contacts/' + contactId, {
                    method: 'PATCH',
                    body: JSON.stringify(updateContact),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }
            ).then(function () {
                syncContacts();
            })
        }

        function deleteContact(contactId) {
            fetch(
                'http://localhost:3000/contacts/' + contactId, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }
            ).then(syncContacts)
        }

        function getContacts() {
            return fetch(
                'http://localhost:3000/contacts'
            ).then(
                function (response) {
                    return response.json();
                }
            )
        }

        function displayContacts(contacts) {
            contactList.innerHTML = '';

            contacts.sort(function(a, b) {
               if (a.lastName.toLowerCase() > b.lastName.toLowerCase()) return -1;
               else if (a.lastName.toLowerCase() < b.lastName.toLowerCase()) return 1;
               else return 0;
            });

            contacts.forEach(function (contact) {
                var listNode = document.createElement('li');
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.setAttribute('contact-id', contact.id);

                var button = document.createElement('button');
                button.innerText = 'Remove';
                button.addEventListener('click', function() {
                    deleteContact(contact.id);
                });

                var editButton = document.createElement('button');
                editButton.innerText = 'Edit';
                editButton.addEventListener('click', function() {
                    var editForm = document.createElement('div');

                    var editFirstName = document.createElement('input');
                    editFirstName.value = contact.firstName;

                    var editLastName = document.createElement('input');
                    editLastName.value = contact.lastName;

                    var editPhoneNumber = document.createElement('input');
                    editPhoneNumber.value = contact.phoneNumber;

                    var editEmail = document.createElement('input');
                    editEmail.value = contact.email;

                    var saveButton = document.createElement('button');
                    saveButton.innerText = 'Save';

                    editForm.appendChild(editFirstName);
                    editForm.appendChild(editLastName);
                    editForm.appendChild(editPhoneNumber);
                    editForm.appendChild(editEmail);
                    editForm.appendChild(saveButton);

                    listNode.appendChild(editForm);

                    saveButton.addEventListener('click', function() {
                        updateContact(contact.id, editFirstName.value, editLastName.value,
                            editPhoneNumber.value, editEmail.value);
                    })
                });

                listNode.innerText = contact.lastName + ', ' + contact.firstName + ' ' +
                        contact.phoneNumber + ' ' +
                        contact.email;

                listNode.prepend(checkbox);
                listNode.appendChild(button);
                listNode.appendChild(editButton);
                contactList.prepend(listNode);
            })
        }

        function syncContacts() {
            getContacts().then(displayContacts);
        }

    </script>
</body>
</html>