<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Contact List</title>
</head>
<body>
    <input id="first-name" />
    <input id="last-name" />
    <input id="phone-number" />
    <input id="email" />
    <button id="add-contact">Add Contact</button>
    <ul id="contacts">


    </ul>
    <script>
        var contactList = document.getElementById('contacts');
        var firstNameInput = document.getElementById('first-name');
        var lastNameInput = document.getElementById('last-name');
        var phoneNumberInput = document.getElementById('phone-number');
        var emailInput = document.getElementById('email');
        var addContactButton = document.getElementById('add-contact');

        syncContacts();

        addContactButton.addEventListener('click', addContact);

        function addContact() {
            var contact = {
                firstName: firstNameInput.value,
                lastName: lastNameInput.value,
                phoneNumber: phoneNumberInput.value,
                email: emailInput.value,
            };

            firstNameInput.value = '';
            lastNameInput.value = '';
            phoneNumberInput.value = '';
            emailInput.value = '';

            fetch(
                'http://localhost:3000/contacts', {
                    method: 'POST',
                    body: JSON.stringify(contact),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }
            ).then(function () {
                syncContacts();
            })
        }

        function getContacts() {
            return fetch(
                'http://localhost:3000/contacts'
            ).then(
                function (response) {
                    return response.json();
                }
            )
        }

        function displayContacts(contacts) {
            contactList.innerHTML = '';

            contacts.sort(function(a, b) {
               if (a.lastName.toLowerCase() > b.lastName.toLowerCase()) return -1;
               else if (a.lastName.toLowerCase() < b.lastName.toLowerCase()) return 1;
               else return 0;
            });
            
            contacts.forEach(function (contact) {
                var listNode = document.createElement('li');

                listNode.innerText = contact.lastName + ', ' + contact.firstName + ' ' +
                        contact.phoneNumber + ' ' +
                        contact.email;

                contactList.prepend(listNode);
            })
        }

        function syncContacts() {
            getContacts().then(displayContacts);
        }

    </script>
</body>
</html>